# 文件系统



runfs 文件系统是符合FAT32标准的文件系统,设计思路采用分层原则,一共设计了4层.



第一层规范了块设备的读取写入方法,并且以特性(Trait)的形式实现,方便接入多种块设备.



第二层是缓存层, 将块设备的内容放入内存,以队列储存.FAT32分为记录区和数据区,记录区是用来记录哪些簇是可用的,或者记录使用过的簇的下一个簇号.数据区是用来存放目录项(文件和文件夹的基本信息)和内容的,以簇的形式(若干个块)存在.所以缓存层也有两类缓存,一个是记录区缓存,一个是数据区缓存.



第三层是记录区和数据区的管理器.记录区管理器负责分配和回收簇,或者查找下一个簇的簇号.数据区负责更改文件的内容.



第四层就是以根目录项为根的目录项树,负责管理文件系统的所有内容.

